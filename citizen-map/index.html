<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PERKS Map - IslandDAO Citizen Registry</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: black;
            height: 100vh;
            overflow: hidden;
            color: white;
            margin: 0;
            padding: 0;
        }
        
        #particleCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 75vh;
            touch-action: none;
        }
        
        .container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            height: 100vh;
            text-align: center;
        }
        
        .particle-section {
            height: 75vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .content {
            height: 25vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem 2rem;
            background: black;
        }
        
        .subtitle {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            opacity: 0.8;
            color: #cccccc;
        }
        
        .buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border: 1px solid #4CAF50;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            border: 1px solid #45a049;
        }

        @media (max-width: 768px) {
            .subtitle {
                font-size: 1rem;
            }
            
            .btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <canvas id="particleCanvas"></canvas>
    
    <div class="container">
        <div class="particle-section">
            <!-- Particle effects display here -->
        </div>
        <div class="content">
            <p class="subtitle">Explore the IslandDAO citizen registry and NFT collection</p>
            
            <div class="buttons">
                <a href="/verified-citizen-map" class="btn btn-primary">View Citizen Map</a>
                <a href="/collection" class="btn">Browse Collection</a>
            </div>
        </div>
    </div>
    
    <script>
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let textImageData = null;
        let mousePosition = { x: 0, y: 0 };
        let isTouching = false;
        let isMobile = window.innerWidth < 768;
        let animationFrameId;

        // IslandDAO logo SVG path - created from your PNG logo
        const ISLAND_LOGO_PATH = "M50 5L60 20L70 5L80 20L70 35L60 20L50 35L40 20L30 35L20 20L30 5L40 20Z M45 35L55 35L55 75L45 75Z M15 80L85 80L85 85L15 85Z M20 90L80 90L80 93L20 93Z M25 96L75 96L75 98L25 98Z M120 15L140 15L140 22L130 22L130 30L135 30L135 37L130 37L130 45L135 45L135 52L130 52L130 60L140 60L140 67L120 67Z M150 15L160 15L160 45L170 45L170 52L150 52Z M180 15L200 15L200 22L190 22L190 30L195 30L195 37L190 37L190 45L195 45L195 52L190 52L190 60L200 60L200 67L180 67Z M210 15L220 15L220 45L235 45L235 52L220 52L220 67L210 67Z M245 15L265 15L255 37L265 60L255 67L245 60L255 37Z M275 15L295 15L285 37L295 67L275 67L285 37Z M305 15L315 15L315 45L330 45L330 52L315 52L315 67L305 67Z M340 15L360 15L350 37L360 67L340 67L350 37Z M370 15L390 15L380 37L390 67L370 67L380 37Z";

        function updateCanvasSize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight * 0.75;
            isMobile = window.innerWidth < 768;
        }

        function createTextImage() {
            if (!ctx || !canvas) return 0;

            ctx.fillStyle = 'white';
            ctx.save();
            
            const logoHeight = isMobile ? 60 : 120;
            const islandLogoWidth = logoHeight * (390 / 98); // Correct aspect ratio from IslandDAO logo
            const totalWidth = islandLogoWidth;
            
            ctx.translate(canvas.width / 2 - totalWidth / 2, canvas.height / 2 - logoHeight / 2);

            // Draw IslandDAO logo
            ctx.save();
            const islandScale = logoHeight / 98;
            ctx.scale(islandScale, islandScale);
            const path = new Path2D(ISLAND_LOGO_PATH);
            ctx.fill(path);
            ctx.restore();

            ctx.restore();

            textImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            return islandScale;
        }

        function createParticle(scale) {
            if (!ctx || !canvas || !textImageData) return null;

            const data = textImageData.data;
            const particleGap = 2;

            for (let attempt = 0; attempt < 100; attempt++) {
                const x = Math.floor(Math.random() * canvas.width);
                const y = Math.floor(Math.random() * canvas.height);

                if (data[(y * canvas.width + x) * 4 + 3] > 128) {
                    return {
                        x: x,
                        y: y,
                        baseX: x,
                        baseY: y,
                        size: Math.random() * 1 + 0.5,
                        color: 'white', 
                        scatteredColor: '#4CAF50', // IslandDAO green
                        life: Math.random() * 100 + 50
                    };
                }
            }

            return null;
        }

        function createInitialParticles(scale) {
            const baseParticleCount = 7000;
            const particleCount = Math.floor(baseParticleCount * Math.sqrt((canvas.width * canvas.height) / (1920 * 1080)));
            for (let i = 0; i < particleCount; i++) {
                const particle = createParticle(scale);
                if (particle) particles.push(particle);
            }
        }

        function animate(scale) {
            if (!ctx || !canvas) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const { x: mouseX, y: mouseY } = mousePosition;
            const maxDistance = 240;

            for (let i = 0; i < particles.length; i++) {
                const p = particles[i];
                const dx = mouseX - p.x;
                const dy = mouseY - p.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < maxDistance && (isTouching || !('ontouchstart' in window))) {
                    const force = (maxDistance - distance) / maxDistance;
                    const angle = Math.atan2(dy, dx);
                    const moveX = Math.cos(angle) * force * 60;
                    const moveY = Math.sin(angle) * force * 60;
                    p.x = p.baseX - moveX;
                    p.y = p.baseY - moveY;
                    
                    ctx.fillStyle = p.scatteredColor;
                } else {
                    p.x += (p.baseX - p.x) * 0.1;
                    p.y += (p.baseY - p.y) * 0.1;
                    ctx.fillStyle = 'white';
                }

                ctx.fillRect(p.x, p.y, p.size, p.size);

                p.life--;
                if (p.life <= 0) {
                    const newParticle = createParticle(scale);
                    if (newParticle) {
                        particles[i] = newParticle;
                    } else {
                        particles.splice(i, 1);
                        i--;
                    }
                }
            }

            const baseParticleCount = 7000;
            const targetParticleCount = Math.floor(baseParticleCount * Math.sqrt((canvas.width * canvas.height) / (1920 * 1080)));
            while (particles.length < targetParticleCount) {
                const newParticle = createParticle(scale);
                if (newParticle) particles.push(newParticle);
            }

            animationFrameId = requestAnimationFrame(() => animate(scale));
        }

        function initialize() {
            console.log('Initializing particle effects...');
            updateCanvasSize();
            console.log('Canvas size:', canvas.width, 'x', canvas.height);
            const scale = createTextImage();
            console.log('Text image created, scale:', scale);
            createInitialParticles(scale);
            console.log('Particles created:', particles.length);
            animate(scale);
        }

        const handleResize = () => {
            updateCanvasSize();
            const newScale = createTextImage();
            particles = [];
            createInitialParticles(newScale);
        };

        const handleMove = (x, y) => {
            mousePosition = { x, y };
        };

        const handleMouseMove = (e) => {
            handleMove(e.clientX, e.clientY);
        };

        const handleTouchMove = (e) => {
            if (e.touches.length > 0) {
                e.preventDefault();
                handleMove(e.touches[0].clientX, e.touches[0].clientY);
            }
        };

        const handleTouchStart = () => {
            isTouching = true;
        };

        const handleTouchEnd = () => {
            isTouching = false;
            mousePosition = { x: 0, y: 0 };
        };

        const handleMouseLeave = () => {
            if (!('ontouchstart' in window)) {
                mousePosition = { x: 0, y: 0 };
            }
        };

        window.addEventListener('resize', handleResize);
        canvas.addEventListener('mousemove', handleMouseMove);
        canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
        canvas.addEventListener('mouseleave', handleMouseLeave);
        canvas.addEventListener('touchstart', handleTouchStart);
        canvas.addEventListener('touchend', handleTouchEnd);

        // Initialize the animation
        initialize();
    </script>
</body>
</html>